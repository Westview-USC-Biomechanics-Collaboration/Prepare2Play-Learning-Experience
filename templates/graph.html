<!DOCTYPE html>
<html>
<head>
    <title>Plotting Graph</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        #plot-container {
            width: 100%;
            margin: auto;
            text-align: left;
        }
        #value-container {
            margin-top: 20px;
        }
        #video-container {
            position: absolute;
            top: 10px;
            right: 10px;
            text-align: center;
        }
        #videoPlayer {
            width: 300px;
        }
    </style>
</head>
<body>
    <div id="plot-container">
        <div id="plot" style="width: 50%; height: 500px;"></div>
        <div id="plot2" style="width: 50%; height: 500px;"></div>
        <div id="value-container"></div>
        <button onclick="goBack()">Back to Home</button>
    </div>
    
    <div id="video-container">
        <video id="videoPlayer" controls>
            Your browser does not support the video tag.
        </video>
        <br>
        <input type="file" id="videoInput" accept="video/*" onchange="playSelectedVideo()">
    </div>

    <script>
        var forcex = JSON.parse('{{ forcex | tojson | safe }}');
        var timex = JSON.parse('{{ timex | tojson | safe }}');

        var forcey = JSON.parse('{{ forcey | tojson | safe }}');
        var timey = JSON.parse('{{ timey | tojson | safe }}');

        var trace1 = {
            x: timex,
            y: forcex,
            mode: 'lines+markers',
            type: 'scatter',
            fill: 'tozeroy'
        };

        var trace2 = {
            x: timey,
            y: forcey,
            mode: 'lines+markers',
            type: 'scatter',
            fill: 'tozeroy'
        };

        var layout1 = {
            xaxis: {
                range: [0, 3],
                title: 'Time (s.)'
            },
            yaxis: {
                range: [-15, 10],
                title: 'Force (N)'
            },
            title: 'Force (X-Direction) vs. Time Graph'
        };

        var layout2 = {
            xaxis: {
                range: [0, 5],
                title: 'Time (s.)'
            },
            yaxis: {
                range: [-25, 25],
                title: 'Force (N)'
            },
            title: 'Force (Y-Direction) vs. Time Graph'
        };

        Plotly.newPlot('plot', [trace1], layout1);
        Plotly.newPlot('plot2', [trace2], layout2);

        function updateValueX(value) {
            document.getElementById('value-container').innerHTML = '<b>Impulse (X-Direction):</b> ' + value + ' J';
        }

        function updateValueY(value) {
            document.getElementById('value-container').innerHTML = '<b>Impulse (Y-Direction):</b> ' + value + ' J';
        }

        document.getElementById('plot').on('plotly_click', function(data){
            var pointIndex = data.points[0].pointIndex;
            var value = timex[pointIndex]; 
            updateValueX(value);
        });

        document.getElementById('plot2').on('plotly_click', function(data){
            var pointIndex = data.points[0].pointIndex;
            var value = timey[pointIndex]; 
            updateValueY(value);
        });

        function goBack() {
            window.location.href = '/';
        }

        // Add animation
        function animatePlot() {
            var frames = [];
            var step = Math.max(1, Math.floor(timex.length / 29.97));  // Larger step to reduce frames
            for (var i = 0; i < timex.length; i += step) {
                frames.push({
                    data: [{x: timex.slice(0, i+1), y: forcex.slice(0, i+1)}]
                });
            }
            Plotly.animate('plot', frames, {
                transition: {
                    duration: 0
                },
                frame: {
                    duration: 20,  // Decrease duration to speed up animation
                    redraw: true
                }
            });
        }

        function animatePlot2() {
            var frames = [];
            var step = Math.max(1, Math.floor(timey.length / 29.97));  // Larger step to reduce frames
            for (var i = 0; i < timey.length; i += step) {
                frames.push({
                    data: [{x: timey.slice(0, i+1), y: forcey.slice(0, i+1)}]
                });
            }
            Plotly.animate('plot2', frames, {
                transition: {
                    duration: 0
                },
                frame: {
                    duration: 20,  // Decrease duration to speed up animation
                    redraw: true
                }
            });
        }

        // Function to play the selected video
        function playSelectedVideo() {
            var videoInput = document.getElementById('videoInput');
            var videoPlayer = document.getElementById('videoPlayer');
            var file = videoInput.files[0];
            var url = URL.createObjectURL(file);
            videoPlayer.src = url;

            videoPlayer.addEventListener('loadeddata', function() {
                if (videoPlayer.readyState >= 3) { 
                    animatePlot();
                    animatePlot2();
                }
            });

            videoPlayer.play();
        }
    </script>
</body>
</html>
